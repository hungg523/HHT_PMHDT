<!DOCTYPE html>
<html lang="en">

<head>
    <title>Nhà thuốc - Danh mục sản phẩm</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap&subset=vietnamese">
    <link rel="icon" href="/assets/images/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/fonts/icomoon/style.css">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/magnific-popup.css">
    <link rel="stylesheet" href="/assets/css/jquery-ui.css">
    <link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">


    <link rel="stylesheet" href="/assets/css/aos.css">
    <link rel="stylesheet" href="/assets/css/popup.css">
    <link rel="stylesheet" href="/assets/css/style.css">
</head>

<body>
    <!-- Navbar -->
    <div class="site-wrap">
        <div class="site-navbar py-2">

            <div class="search-wrap" id="searchSection" style="display: none;">
                <div class="container">
                    <a href="#" class="search-close js-search-close" onclick="toggleSearch(false)">
                        <span class="icon-close2"></span>
                    </a>
                    <form onsubmit="searchProduct(event)">
                        <input type="text" class="form-control" id="searchInput" placeholder="Nhập tên sản phẩm...">
                    </form>
                </div>
            </div>


            <div class="container">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="logo">
                        <div class="site-logo">
                            <a href="/index.html" class="js-logo-clone">HHT <span
                                    style="color: #5eba24;">Pharmacy</span></a>
                        </div>
                    </div>

                    <div class="main-nav d-none d-lg-block">
                        <nav class="site-navigation text-right text-md-center" role="navigation">
                            <ul class="site-menu js-clone-nav d-none d-lg-block">
                                <li class="active"><a href="index.html"><strong>Trang chủ</strong></a></li>
                                <li class="has-children">
                                    <a href="#"><strong>Danh mục</strong></a>
                                    <ul class="dropdown" id="categoryList">
                                        <!-- Danh mục hiển thị từ API -->
                                    </ul>
                                </li>
                                <li><a href="/pages/shop.html"><strong>Sản phẩm</strong></a></li>
                                <li><a href="/pages/about.html"><strong>Về chúng tôi</strong></a></li>
                                <li><a href="/pages/contact.html"><strong>Liên hệ</strong></a></li>
                            </ul>
                        </nav>
                    </div>
                    <a href="#" class="icons-btn d-inline-block js-search-open" onclick="toggleSearch(true)"><span
                            class="icon-search"></span></a>
                    <div class="icons">
                        <!-- Link mở popup Đăng nhập và Đăng ký -->
                        <div class="icons" id="accountSection">
                            <!-- Nội dung sẽ được JavaScript cập nhật -->
                            <a href="cart.html" class="icons-btn d-inline-block bag">
                                <span class="icon-shopping-bag"></span>
                                <span class="number">2</span>
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Breadcrumb -->
    <div class="bg-light py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-12 mb-0">
                    <a href="/index.html">Trang chủ</a> <span class="mx-2 mb-0">/</span>
                    <strong class="text-black" id="categoryName">Sản phẩm</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="site-section">
        <div class="container">
            <div class="row product-list" id="productList">
                <!-- Sản phẩm sẽ hiển thị ở đây thông qua API -->
            </div>
            <div class="pagination text-center mt-4">
                <!-- Nút phân trang sẽ được chèn vào đây -->
            </div>
        </div>
    </div>

    <div class="site-section bg-secondary bg-image" style="background-image: url('/assets/images/bg_2.jpg');">
        <div class="container">
            <div class="row align-items-stretch">
                <div class="col-lg-6 mb-5 mb-lg-0">
                    <a href="#" class="banner-1 h-100 d-flex" style="background-image: url('/assets/images/bg_1.jpg');">
                        <div class="banner-1-inner align-self-center">
                            <h2>Pharma Products</h2>
                            <p>HHT Pharmacy cung cấp các sản phẩm dược phẩm chất lượng cao, đa dạng từ thuốc điều
                                trị bệnh, thực phẩm chức năng đến các sản phẩm chăm sóc sức khỏe. Với cam kết về an
                                toàn và hiệu quả.
                            </p>
                        </div>
                    </a>
                </div>
                <div class="col-lg-6 mb-5 mb-lg-0">
                    <a href="#" class="banner-1 h-100 d-flex" style="background-image: url('/assets/images/bg_2.jpg');">
                        <div class="banner-1-inner ml-auto  align-self-center">
                            <h2>Đánh giá bởi chuyên gia</h2>
                            <p>hương hiệu được các chuyên gia y tế đánh giá cao về độ an toàn và hiệu quả trong việc
                                hỗ trợ điều trị và chăm sóc sức khỏe..
                            </p>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-3 mb-4 mb-lg-0">

                    <div class="block-7">
                        <h3 class="footer-heading mb-4">Thông tin</h3>
                        <p>"Pharma cam kết mang đến các sản phẩm chăm sóc sức khỏe chất lượng, uy tín từ các
                            thương hiệu hàng đầu. Chúng tôi cung cấp đa dạng các loại thuốc, thực phẩm chức năng, và
                            sản
                            phẩm hỗ trợ
                            sức khỏe với đội ngũ tư vấn tận tình, chuyên nghiệp. Mục tiêu của chúng tôi là luôn đồng
                            hành cùng sức
                            khỏe của bạn và gia đình."
                        </p>
                    </div>

                </div>

                <div class="col-lg-3 mx-auto mb-5 mb-lg-0">
                    <h3 class="footer-heading mb-4">Danh mục</h3>
                    <ul class="list-unstyled" id="categoryListFooter">
                        <!-- Danh mục từ API -->
                    </ul>

                </div>

                <div class="col-md-6 col-lg-3">
                    <div class="block-5 mb-5">
                        <h3 class="footer-heading mb-4">Liên hệ</h3>
                        <ul class="list-unstyled">
                            <li class="address">Đại học Trà Vinh</li>
                            <li class="phone"><a href="tel://379932119">+84379932119</a></li>
                            <li class="email">Pharma@st.tvu.edu.vn</li>
                        </ul>
                    </div>
                </div>

                <!-- Popup Đăng nhập -->
                <div class="popup-overlay" id="loginPopup">
                    <div class="popup-box">
                        <span class="close-btn" onclick="closePopup('loginPopup')">&times;</span>
                        <h3 style="text-align: center;">ĐĂNG NHẬP</h3>
                        <hr>
                        <form id="loginForm" onsubmit="loginUser(event)">
                            <div class="form-group">
                                <label for="email">Tên đăng nhập</label>
                                <input type="text" id="email" name="email" class="form-control" required>
                            </div>
                            <div class="form-group mt-3">
                                <label for="password">Mật khẩu</label>
                                <input type="password" id="password" name="password" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block mt-4">Đăng nhập</button>
                        </form>
                        <p class="mt-3">
                            Chưa có tài khoản? <a href="#" onclick="switchPopup('loginPopup', 'registerPopup')">Đăng
                                ký</a><br>
                            <a href="#" class="text-primary"
                                onclick="switchPopup('loginPopup', 'forgotPasswordPopup')">Quên mật khẩu?</a>
                        </p>
                    </div>
                </div>


                <!-- Popup Đăng ký -->
                <div class="popup-overlay" id="registerPopup">
                    <div class="popup-box">
                        <span class="close-btn" onclick="closePopup('registerPopup')">&times;</span>
                        <h3 style="text-align: center;">ĐĂNG KÝ</h3>
                        <hr>

                        <!-- Bước 1: Nhập thông tin đăng ký -->
                        <form id="registerForm" class="form-step-1">
                            <div class="form-group mt-3">
                                <label for="registerEmail">Email</label>
                                <input type="email" id="registerEmail" name="registerEmail" class="form-control"
                                    required>
                            </div>
                            <div class="form-group mt-3">
                                <label for="regPassword">Mật khẩu</label>
                                <input type="password" id="regPassword" name="regPassword" class="form-control"
                                    required>
                            </div>
                            <div class="form-group mt-3">
                                <label for="confirmPassword">Xác nhận mật khẩu</label>
                                <input type="password" id="confirmPassword" name="confirmPassword" class="form-control"
                                    required>
                            </div>
                            <button type="button" class="btn btn-primary btn-block mt-4" onclick="registerUser()">Đăng
                                ký</button>
                        </form>

                        <!-- Bước 2: Nhập OTP để xác thực -->
                        <form id="otpForm" class="form-step-2" style="display: none;">
                            <div class="form-group mt-3">
                                <label for="otp">Mã OTP</label>
                                <input type="text" id="otp" name="otp" class="form-control" placeholder="Nhập mã OTP"
                                    required>
                            </div>
                            <div class="mt-3">
                                <button type="button" id="resendOtpButton" class="btn btn-primary btn-block mt-4"
                                    onclick="resendOtp()" disabled>
                                    <span id="countdown">75</span>
                                </button>
                            </div>
                            <button type="button" class="btn btn-primary btn-block mt-4" onclick="verifyOtp()">Xác thực
                                OTP</button>
                        </form>

                        <p class="mt-3">Đã có tài khoản? <a href="#"
                                onclick="switchPopup('registerPopup', 'loginPopup')">Đăng nhập</a>
                        </p>
                    </div>
                </div>

                <!-- Popup Quên mật khẩu -->
                <div class="popup-overlay" id="forgotPasswordPopup">
                    <div class="popup-box">
                        <span class="close-btn" onclick="closePopup('forgotPasswordPopup')">&times;</span>
                        <h3 style="text-align: center;">QUÊN MẬT KHẨU</h3>
                        <hr>

                        <!-- Bước 1: Nhập Email -->
                        <form id="forgotPasswordForm" class="form-step-1">
                            <div class="form-group mt-3">
                                <label for="forgotEmail">Email</label>
                                <input type="email" id="forgotEmail" name="forgotEmail" class="form-control"
                                    placeholder="Nhập email của bạn" required>
                            </div>
                            <button type="button" class="btn btn-primary btn-block mt-4"
                                onclick="sendForgotPasswordOtp()">Gửi OTP</button>
                        </form>

                        <!-- Bước 2: Nhập OTP và Đặt lại mật khẩu -->
                        <form id="resetPasswordForm" class="form-step-2" style="display: none;">
                            <div class="form-group mt-3">
                                <label for="resetOtp">Mã OTP</label>
                                <input type="text" id="resetOtp" name="resetOtp" class="form-control"
                                    placeholder="Nhập mã OTP" required>
                            </div>
                            <div class="form-group mt-3">
                                <label for="newPassword">Mật khẩu mới</label>
                                <input type="password" id="newPassword" name="newPassword" class="form-control"
                                    required>
                            </div>
                            <div class="form-group mt-3">
                                <label for="confirmNewPassword">Xác nhận mật khẩu mới</label>
                                <input type="password" id="confirmNewPassword" name="confirmNewPassword"
                                    class="form-control" required>
                            </div>
                            <button type="button" class="btn btn-primary btn-block mt-4" onclick="resetPassword()">Đặt
                                lại mật khẩu</button>
                        </form>
                    </div>
                </div>

                <!-- Popup Notification -->
                <div class="modal fade" id="notificationModal" tabindex="-1" role="dialog"
                    aria-labelledby="notificationTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="notificationTitle">Thông báo</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body" id="notificationMessage">
                                <!-- Thông báo sẽ được đặt ở đây -->
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </div>
                </div>

                <script src="/assets/js/jquery-3.3.1.min.js"></script>
                <script src="/assets/js/jquery-ui.js"></script>
                <script src="/assets/js/popper.min.js"></script>
                <script src="/assets/js/bootstrap.min.js"></script>
                <script src="/assets/js/owl.carousel.min.js"></script>
                <script src="/assets/js/jquery.magnific-popup.min.js"></script>
                <script src="/assets/js/aos.js"></script>
                <script src="/assets/js/main.js"></script>
                <script src="/assets/js/nav.js"></script>
                <script src="/assets/js/footer.js"></script>
                <script src="/assets/js/login.js"></script>
                <script src="/assets/js/popup.js"></script>
                <script src="/assets/js/register.js"></script>
                <script src="/assets/js/changepassword.js"></script>

                <script>
                    // Lấy ID danh mục từ URL
                    function getCategoryId() {
                        const urlParams = new URLSearchParams(window.location.search);
                        return urlParams.get('id');
                    }
                    // Lấy tên danh mục dựa trên ID
                    async function fetchCategoryName(categoryId) {
                        try {
                            const response = await fetch('https://localhost:1006/get-categories');
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            const categories = await response.json();
                            const category = categories.find(cat => cat.id == categoryId);
                            return category ? category.name : 'Danh mục không tồn tại';
                        } catch (error) {
                            console.error('Error fetching categories:', error);
                            return 'Lỗi khi tải danh mục';
                        }
                    }

                    // Định dạng giá tiền
                    function formatCurrency(value) {
                        return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                    }

                    let currentPage = 1; // Trang hiện tại
                    const pageSize = 6; // Số sản phẩm mỗi trang

                    async function fetchCategoryProducts(categoryId, page = 1) {
                        try {
                            const response = await fetch(`https://localhost:1006/get-products-by-category?id=${categoryId}&page=${page}&pageSize=${pageSize}`);

                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }

                            const data = await response.json();
                            const products = data.data; // Danh sách sản phẩm
                            const totalPages = data.totalPages; // Tổng số trang

                            const productList = document.getElementById('productList');
                            productList.innerHTML = '';

                            // Kiểm tra nếu không có sản phẩm
                            if (products.length === 0) {
                                productList.innerHTML = '<p>Hiện tại không có sản phẩm!</p>';
                                return;
                            }

                            // Hiển thị sản phẩm
                            products.forEach(product => {
                                const regularPrice = formatCurrency(product.regularPrice) + " VNĐ";
                                const discountPrice = product.discountPrice ? formatCurrency(product.discountPrice) + " VNĐ" : null;

                                const productHtml = `
                                    <div class="col-sm-6 col-lg-4 text-center item mb-4 shadow-sm" style="padding: 10px; border-radius: 8px;">
                                    ${product.discountPrice && product.discountPrice > 0 ? '<span class="tag">Sale</span>' : ''}
                                    <a href="/pages/shop-single.html?id=${product.id}">
                                        <img src="https://localhost:1005/${product.imagePath}" alt="${product.productName}" style="width: 270px; height: 370px;">
                                    </a>
                                    <h3 class="text-dark" style="color: black;">
                                    <a href="shop-single.html?id=${product.id}" style="color: black;">${product.productName}</a>
                                    </h3>
                                    <p class="brand" style="color: black;">
                                        <strong>Brand:</strong> ${product.brand}
                                    </p>
                                    <p class="packaging" style="color: black;">
                                        <strong>Packaging:</strong> ${product.packaging}
                                    </p>
                                    <p class="origin" style="color: black;">
                                        <strong>Origin:</strong> ${product.origin}
                                    </p>
                                    <p class="price" style="color: black;">
                                        ${product.discountPrice && product.discountPrice > 0
                                            ? `<del style="color: #aaa;">${regularPrice}</del> &mdash; <span style="color: #007bff;">${discountPrice}</span>`
                                            : `<span style="color: #007bff;">${regularPrice}</span>`}
                                    </p>
                                    
                                    <div class="d-flex justify-content-between align-items-center" style="color: black; font-size: 15px; gap: 5px;">
                                    <div>
                                        <span style="color: gold;">&#9733;&#9733;&#9733;&#9733;&#9734;</span> (4.5/5)
                                        <strong>Đã bán:</strong> ${product.amountSeller}
                                    </div>
                                    </div>`;
                                productList.insertAdjacentHTML('beforeend', productHtml);
                            });

                            // Tạo phân trang
                            createPagination(totalPages, categoryId);
                        } catch (error) {
                            console.error('Error fetching category products:', error);
                            document.getElementById('productList').innerHTML = '<p>Không thể tải sản phẩm trong danh mục này.</p>';
                        }
                    }
                    function createPagination(totalPages, categoryId) {
                        const paginationContainer = document.querySelector('.pagination');
                        paginationContainer.innerHTML = ''; // Xóa phân trang cũ

                        for (let i = 1; i <= totalPages; i++) {
                            const pageButton = document.createElement('button');
                            pageButton.textContent = i;
                            pageButton.classList.add('btn', 'btn-sm', 'btn-outline-primary', 'mx-1');
                            if (i === currentPage) pageButton.classList.add('active');

                            // Sự kiện click để chuyển trang
                            pageButton.addEventListener('click', () => {
                                currentPage = i;
                                fetchCategoryProducts(categoryId, currentPage); // Tải sản phẩm của trang mới
                            });

                            paginationContainer.appendChild(pageButton);
                        }
                    }

                    document.addEventListener('DOMContentLoaded', async () => {
                        const categoryId = getCategoryId();
                        if (categoryId) {
                            const categoryName = await fetchCategoryName(categoryId);
                            document.getElementById('categoryName').textContent = categoryName;
                            fetchCategoryProducts(categoryId, currentPage);
                        } else {
                            document.getElementById('productList').innerHTML = '<p>Không tìm thấy danh mục sản phẩm.</p>';
                        }
                    });

                </script>

</body>

</html>
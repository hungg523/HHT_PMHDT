<!DOCTYPE html>
<html lang="en">

<head>
    <title>Nhà thuốc - Cập nhật hồ sơ</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap&subset=vietnamese">
    <link rel="icon" href="/assets/images/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/fonts/icomoon/style.css">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
</head>

<body>
    <!-- Navbar -->
    <!-- Include navbar code here -->

    <!-- Profile Update Form -->
    <div class="site-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center mb-5">
                    <h2 class="text-uppercase">Cập nhật hồ sơ cá nhân</h2>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <form id="profileForm" onsubmit="updateProfile(event)">
                        <div class="form-group">
                            <label for="fullName">Họ và Tên</label>
                            <input type="text" id="fullName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Số điện thoại</label>
                            <input type="text" id="phone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="address">Địa chỉ</label>
                            <input type="text" id="address" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block mt-4">Lưu thay đổi</button>
                        <button type="button" class="btn btn-secondary btn-block mt-2" onclick="cancelUpdate()">Hủy
                            bỏ</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <!-- Include footer code here -->

    <script src="/assets/js/jquery-3.3.1.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/main.js"></script>

    <script>
        // Load user data from localStorage or API
        document.addEventListener("DOMContentLoaded", function () {
            const userData = {
                fullName: localStorage.getItem("userFullName") || "",
                email: localStorage.getItem("userEmail") || "",
                phone: localStorage.getItem("userPhone") || "",
                address: localStorage.getItem("userAddress") || ""
            };

            // Populate form fields with stored data
            document.getElementById("fullName").value = userData.fullName;
            document.getElementById("email").value = userData.email;
            document.getElementById("phone").value = userData.phone;
            document.getElementById("address").value = userData.address;
        });

        // Update profile function
        async function updateProfile(event) {
            event.preventDefault();

            const updatedData = {
                fullName: document.getElementById("fullName").value,
                email: document.getElementById("email").value,
                phone: document.getElementById("phone").value,
                address: document.getElementById("address").value
            };

            try {
                const response = await fetch("https://localhost:1006/update-profile", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(updatedData)
                });

                if (response.ok) {
                    // Lưu vào localStorage để cập nhật nhanh trên frontend
                    localStorage.setItem("userFullName", updatedData.fullName);
                    localStorage.setItem("userEmail", updatedData.email);
                    localStorage.setItem("userPhone", updatedData.phone);
                    localStorage.setItem("userAddress", updatedData.address);

                    alert("Cập nhật hồ sơ thành công!");
                } else {
                    alert("Cập nhật hồ sơ thất bại. Vui lòng thử lại.");
                }
            } catch (error) {
                console.error("Error updating profile:", error);
                alert("Không thể kết nối tới máy chủ.");
            }
        }

        // Cancel update and reset form to original values
        function cancelUpdate() {
            location.reload();
        }
    </script>

</body>

</html>
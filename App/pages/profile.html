<!DOCTYPE html>
<html lang="en">

<head>
    <title>Nhà thuốc - Hồ sơ cá nhân</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap&subset=vietnamese">
    <link rel="icon" href="/assets/images/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/fonts/icomoon/style.css">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
</head>

<body>
    <!-- Navbar -->
    <div class="site-wrap">
        <div class="site-navbar py-2">

            <div class="search-wrap" id="searchSection" style="display: none;">
                <div class="container">
                    <a href="#" class="search-close js-search-close" onclick="toggleSearch(false)">
                        <span class="icon-close2"></span>
                    </a>
                    <form onsubmit="searchProduct(event)">
                        <input type="text" class="form-control" id="searchInput" placeholder="Nhập tên sản phẩm...">
                    </form>
                </div>
            </div>


            <div class="container">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="logo">
                        <div class="site-logo">
                            <a href="/index.html" class="js-logo-clone">HHT <span
                                    style="color: #5eba24;">Pharmacy</span></a>
                        </div>
                    </div>

                    <div class="main-nav d-none d-lg-block">
                        <nav class="site-navigation text-right text-md-center" role="navigation">
                            <ul class="site-menu js-clone-nav d-none d-lg-block">
                                <li class="active"><a href="/index.html"><strong>Trang chủ</strong></a></li>
                                <li class="has-children">
                                    <a href="#"><strong>Danh mục</strong></a>
                                    <ul class="dropdown" id="categoryList">
                                        <!-- Danh mục hiển thị từ API -->
                                    </ul>
                                </li>
                                <li><a href="/pages/shop.html"><strong>Sản phẩm</strong></a></li>
                                <li><a href="/pages/about.html"><strong>Về chúng tôi</strong></a></li>
                                <li><a href="/pages/contact.html"><strong>Liên hệ</strong></a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Profile -->
    <div class="site-section">
        <div class="container">
            <div class="row">
                <!-- Left Sidebar with Avatar and Name -->
                <div class="col-md-4 text-center">
                    <img src="/assets/images/user.png" alt="User Avatar" id="userAvatar"
                        class="img-fluid rounded-circle mb-3" style="width: 250px;">

                    <hr>
                    <h3 id="userName"></h3>
                    <input type="file" id="avatarInput" class="d-none" accept="image/*" onchange="updateAvatar()">
                    <button class="btn btn-primary mt-3" onclick="document.getElementById('avatarInput').click()">Cập
                        nhật ảnh đại diện</button>
                </div>

                <!-- Right Side with Tabs -->
                <div class="col-md-8">
                    <ul class="nav nav-tabs" id="profileTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="orders-tab" data-toggle="tab" href="#orders" role="tab"
                                aria-controls="orders" aria-selected="true">Xem Đơn Hàng</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="edit-profile-tab" data-toggle="tab" href="#editProfile" role="tab"
                                aria-controls="editProfile" aria-selected="false">Chỉnh Sửa Hồ Sơ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="add-address-tab" data-toggle="tab" href="#addAddress" role="tab"
                                aria-controls="addAddress" aria-selected="false">Thêm Địa Chỉ</a>
                        </li>
                    </ul>
                    <div class="tab-content" id="profileTabContent">
                        <!-- Orders Tab -->
                        <div class="tab-pane fade show active" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                            <h4 class="mt-4">Danh Sách Đơn Hàng</h4>
                            <p>Chưa có đơn hàng nào.</p>
                            <!-- Load danh sách đơn hàng từ API -->
                        </div>

                        <!-- Edit Profile Tab -->
                        <div class="tab-pane fade" id="editProfile" role="tabpanel" aria-labelledby="edit-profile-tab">
                            <h4 class="mt-4">Chỉnh Sửa Hồ Sơ</h4>
                            <form id="profileForm" onsubmit="updateProfile(event)">
                                <div class="form-group">
                                    <label for="fullName">Họ và Tên</label>
                                    <input type="text" id="fullName" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" class="form-control" required readonly>
                                </div>
                                <div class="form-group">
                                    <label for="phone">Số điện thoại</label>
                                    <input type="text" id="phone" class="form-control" required maxlength="11"
                                        oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 11);"
                                        placeholder="Nhập số điện thoại tối đa 11 chữ số">
                                </div>
                                <button type="submit" class="btn btn-primary btn-block mt-4">Lưu thay đổi</button>
                            </form>
                        </div>

                        <!-- Add Address Tab -->
                        <div class="tab-pane fade" id="addAddress" role="tabpanel" aria-labelledby="add-address-tab">
                            <form id="addressForm" onsubmit="addAddress(event)" class="mt-4">
                                <h4 class="text-uppercase">Thêm địa chỉ mới</h4>
                                <div class="form-group">
                                    <label for="newFullName">Họ và Tên</label>
                                    <input type="text" id="newFullName" class="form-control" required
                                        placeholder="Nhập họ và tên">
                                </div>
                                <div class="form-group">
                                    <label for="newPhone">Số điện thoại</label>
                                    <input type="text" id="newPhone" class="form-control" required maxlength="11"
                                        oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 11);"
                                        placeholder="Nhập số điện thoại tối đa 11 chữ số">
                                </div>
                                <div class="form-group">
                                    <label for="newAddress">Địa chỉ</label>
                                    <input type="text" id="newAddress" class="form-control" required
                                        placeholder="Nhập họ và tên">
                                </div>
                                <div class="form-group">
                                    <label for="province">Tỉnh/Thành phố</label>
                                    <select id="province" class="form-control" required onchange="fetchDistricts()">
                                        <option value="">Chọn Tỉnh/Thành phố</option>
                                        <!-- Tỉnh/Thành phố sẽ được thêm động từ API -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="district">Quận/Huyện</label>
                                    <select id="district" class="form-control" required onchange="fetchWards()">
                                        <option value="">Chọn Quận/Huyện</option>
                                        <!-- Quận/Huyện sẽ được thêm động từ API -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="ward">Phường/Xã</label>
                                    <select id="ward" class="form-control" required>
                                        <option value="">Chọn Phường/Xã</option>
                                        <!-- Phường/Xã sẽ được thêm động từ API -->
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block mt-4">Thêm địa chỉ</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-3 mb-4 mb-lg-0">

                    <div class="block-7">
                        <h3 class="footer-heading mb-4">Thông tin</h3>
                        <p>"Pharma cam kết mang đến các sản phẩm chăm sóc sức khỏe chất lượng, uy tín từ các
                            thương hiệu hàng đầu. Chúng tôi cung cấp đa dạng các loại thuốc, thực phẩm chức năng, và sản
                            phẩm hỗ trợ
                            sức khỏe với đội ngũ tư vấn tận tình, chuyên nghiệp. Mục tiêu của chúng tôi là luôn đồng
                            hành cùng sức
                            khỏe của bạn và gia đình."
                        </p>
                    </div>

                </div>
                <div class="col-lg-3 mx-auto mb-5 mb-lg-0">
                    <h3 class="footer-heading mb-4">Danh mục</h3>
                    <ul class="list-unstyled" id="categoryListFooter">
                        <!-- Danh mục từ API -->
                    </ul>
                </div>

                <div class="col-md-6 col-lg-3">
                    <div class="block-5 mb-5">
                        <h3 class="footer-heading mb-4">Liên hệ</h3>
                        <ul class="list-unstyled">
                            <li class="address">Đại học Trà Vinh</li>
                            <li class="phone"><a href="tel://379932119">+84379932119</a></li>
                            <li class="email">Pharma@st.tvu.edu.vn</li>
                        </ul>
                    </div>


                </div>
            </div>
            <div class="row pt-5 mt-5 text-center">
                <div class="col-md-12">
                    <p>
                        Copyright &copy;
                        <script>document.write(new Date().getFullYear());</script> All rights reserved | This website is
                        made
                        with by a group of students <a href="https://www.tvu.edu.vn/" target="_blank"
                            class="text-primary">TVU</a>
                    </p>
                </div>

            </div>
        </div>
    </footer>

    <script src="/assets/js/jquery-3.3.1.min.js"></script>
    <script src="/assets/js/jquery-ui.js"></script>
    <script src="/assets/js/popper.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/owl.carousel.min.js"></script>
    <script src="/assets/js/jquery.magnific-popup.min.js"></script>
    <script src="/assets/js/aos.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/nav.js"></script>
    <script src="/assets/js/footer.js"></script>
    <script src="/assets/js/login.js"></script>
    <script src="/assets/js/popup.js"></script>
    <script src="/assets/js/register.js"></script>
    <script src="/assets/js/user.js"></script>
    <script src="/Admin/assets/js/imgToBase64.js"></script>

    <script>
        function updateAvatar() {
            convertToBase64("avatarInput", async function (base64Image) {
                if (base64Image && customerId) {
                    const payload = {
                        id: customerId,
                        avatarBase64: base64Image
                    };

                    try {
                        const response = await fetch(`https://localhost:1006/update-profile-customer?id=${customerId}`, {
                            method: "PUT",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            document.getElementById("userAvatar").src = base64Image;
                            alert("Cập nhật ảnh đại diện thành công!");
                        } else {
                            alert("Cập nhật ảnh đại diện thất bại. Vui lòng thử lại.");
                        }
                    } catch (error) {
                        console.error("Error updating avatar:", error);
                        alert("Không thể kết nối tới máy chủ.");
                    }
                }
            });
        }

    </script>
</body>

</html>